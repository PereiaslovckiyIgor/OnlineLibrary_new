@using LibOnline.Models.Books;
@using LibOnline.Models.Authors;
@using LibOnline.Models.Categories;



@{
    List<UserBookToShow> userBooks = ViewBag.UserBooks;
}



@Html.Partial("_CategoriesPartail")



<div class="span9 blog">


    @foreach (var item in userBooks)
    {
        <article class="clearfix">
            <a asp-controller="BooksDescription" asp-action="GetBookDescription" asp-route-IdBook="@item.IdBook">
                <img asp-append-version="true" src="@item.ImagePath" alt="Post Thumb" class="align-left img_userPage">
            </a>

            <h4 class="title-bg">
                <a asp-controller="BooksDescription" asp-action="GetBooksAuthors" asp-route-IdBook="@item.IdBook">@item.BookName</a>
            </h4>
            <p align="justify">@item.BooksDescription</p>

            <button class="btn btn-large btn-inverse" type="button" onclick="ContinueToRead(@item.IdBook, @item.IdPage)">Продолжить чтение</button>
            <button class="btn btn-large btn-danger" type="button"  onclick="RemoveUserBook(@item.IdBook)">Удалить</button>
            <div class="post-summary-footer">
                <ul class="post-data-3">
                    <li><i class="icon-calendar"></i> @item.ReleasedData.Day/@item.ReleasedData.Month/@item.ReleasedData.Year</li>
                    <li>
                        <i class="icon-user"></i>
                        @foreach (Author author in item.BookAuthors)
                        {

                            <a asp-controller="BooksCategories" asp-action="GetBooksAuthors"
                               asp-route-IdAuthor="@author.IdAuthor"
                               asp-route-pageNumber="1"
                               asp-route-AuthorFullName="@author.AuthorFullName">
                                @author.AuthorFullName
                            </a>
                            if (author != item.BookAuthors.Last())
                            {
                                @Html.Raw(", ")
                            }
                        }

                    </li>
                    <li>
                        <i class="icon-comment"></i>
                        <a asp-controller="BooksDescription" asp-action="BooksDescription" asp-fragment="comments">5 Отзывов</a>
                    </li>
                    <li>
                        <i class="icon-tags"></i>
                        @foreach (Category category in item.BookCategories)
                        {
                            <a asp-controller="BooksCategories" asp-action="GetBooksCategories"
                               asp-route-IdCategory="@category.IdCategory"
                               asp-route-pageNumber="1">
                                @category.CategoryName
                            </a>
                            if (category != item.BookCategories.Last())
                            {
                                @Html.Raw(", ")
                            }
                        }
                    </li>
                </ul>
            </div>
        </article>
    }

    <!-- Pagination -->
    <div class="pagination">
        <ul>
            <li class="active"><a href="#">Prev</a></li>
            <li class="active"><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">Next</a></li>
        </ul>
    </div>
</div>

<script>
    // Переход на страницу книги
    function ContinueToRead(BookId, PageId) {
        let Url = '@Url.Action("GetPageContent", "BooksPage")?IdBook=' + BookId + '&PageNumber=' + PageId;
        $(location).attr('href', Url.replace(/&amp;/g, "&"));
    }//ContinueToRead

    // Удаление книги из избранного
    function RemoveUserBook(IdBook) {
        $.ajax({
            url: '/UserPage/RemoveUserBook',
            dataType: "json",
            data: {
                IdBook: IdBook
            },
            success: function (result) {
                if (result.success === true)
                    swal(result.responseText, "", "success").then(okay => {
                        if (okay) {
                            window.location.reload();
                        }
                    });
                else
                    swal("Ошибка", result.responseText, "error");
            }
        });//ajax
    }//RemoveUserBook

</script>